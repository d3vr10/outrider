# Example: Deploy images to Docker Swarm cluster
#
# This example shows how to pull images and deploy them
# to multiple Docker Swarm nodes with custom loading script

images:
  - myapp:v1.0
  - postgres:15-alpine
  - redis:7-alpine

runtime:
  type: docker

transport:
  type: ssh
  options:
    key_file: ~/.ssh/id_rsa

targets:
  - host: swarm-node-1.example.com
    user: ubuntu
    port: 22

  - host: swarm-node-2.example.com
    user: ubuntu
    port: 22

  - host: swarm-node-3.example.com
    user: ubuntu
    port: 22

output_tar: ./swarm-images.tar
remote_tar_path: /tmp/swarm-images.tar

post_instructions:
  plugin: generic_ssh
  options:
    command: |
      docker load < {tar_path} && \
      rm -f {tar_path} && \
      echo "Images loaded successfully"
